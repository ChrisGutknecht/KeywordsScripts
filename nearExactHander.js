/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/


/* norisk DANGER ZONE: You have taken this too far.

- If you tried to log this into the Ads Scripts console, it's not going to work with the 100k char logger limit
- If you managed to log this into to the browser (good job finding the UserAgent), the core business logic is uglified and impossible to reverse engineer

NOTE: This specific request is logged via Google Analytics including the AdWords account ID and will trigger an alert on behalf of norisk.




                            uuuuuuu
                         uu$$$$$$$$$$$uu
                      uu$$$$$$$$$$$$$$$$$uu
                     u$$$$$$$$$$$$$$$$$$$$$u
                    u$$$$$$$$$$$$$$$$$$$$$$$u
                   u$$$$$$$$$$$$$$$$$$$$$$$$$u
                   u$$$$$$$$$$$$$$$$$$$$$$$$$u
                   u$$$$$$"   "$$$"   "$$$$$$u
                   "$$$$"      u$u       $$$$"
                    $$$u       u$u       u$$$
                    $$$u      u$$$u      u$$$
                     "$$$$uu$$$   $$$uu$$$$"
                      "$$$$$$$"   "$$$$$$$"
                        u$$$$$$$u$$$$$$$u
                         u$"$"$"$"$"$"$u
              uuu        $$u$ $ $ $ $u$$       uuu
             u$$$$        $$$$$u$u$u$$$       u$$$$
              $$$$$uu      "$$$$$$$$$"     uu$$$$$$
            u$$$$$$$$$$$uu    """""    uuuu$$$$$$$$$$
            $$$$"""$$$$$$$$$$uuu   uu$$$$$$$$$"""$$$"
             """      ""$$$$$$$$$$$uu ""$"""
                       uuuu ""$$$$$$$$$$uuu
              u$$$uuu$$$$$$$$$uu ""$$$$$$$$$$$uuu$$$
              $$$$$$$$$$""""           ""$$$$$$$$$$$"
               "$$$$$"                      ""$$$$""
                 $$$"                         $$$$"


/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/

/****************************************************/
/************* GLOBAL CONSTANTS *********************/
/****************************************************/

var AG_CHECK_LABEL;
var KEYWORD_LABEL_SAME = "nrNearExact_SameAG", KEYWORD_LABEL_SPLIT = "nrNearExact_Keyword_AG-Split";
var ALLQUERIES = [];
var CREATED_ADGROUPS = [["Campaign", "Adgroup", "Single_Keyword", "Previous Clicks"]], ADDED_KEYWORDS = [["Campaign", "Adgroup", "_______New Keyword_______", "_______Source Keyword_______", "Query Type", "Previous Clicks"]];
var SCRIPT_NAME = "NearExactHandler";
var SET_NEGATIVE_IN_QUERY_SOURCE = 1;
var MIN_IMP_FOR_REFERENCE_KEYWORD = typeof MIN_IMP_FOR_REFERENCE_QUERY === "undefined" ? MIN_IMP_FOR_REFERENCE_KEYWORD : MIN_IMP_FOR_REFERENCE_QUERY;

var CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP = typeof CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP !== "undefined" ? CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP : {
  "minShareOfKeywordClicks" : 0.009, // read: the query must have at least 0.01 or 1% of the keywords clicks (recommended)
  "minRelativeCpc_ToKeyword" : 0.95, // read: the query should be a least 1% more expensive than the keyword (recommended)
  "minSimilarity_ToKeyword" : 0.9, // read: based on a 'letter changes to word length' ratio, the query should be least 90% similar
};


function relatedQuerySplitter() {

  AG_CHECK_LABEL = getWeekLabel();
  provideLabel(AG_CHECK_LABEL);
  
  Logger.log("Analyzing NearExact Queries from " + DATE_RANGE);

  var adGroupIterator = AdWordsApp.adGroups()
    .withCondition('Clicks >= ' + MIN_QUERY_CLICKS)
    .withCondition('CampaignName CONTAINS_IGNORE_CASE \"' + CAMPAIGN_INCLUDE_STRING + '\"')
    .withCondition('CampaignName DOES_NOT_CONTAIN \"' + CAMPAIGN_EXCLUDE_STRING + '\"')
    .withCondition('CampaignName DOES_NOT_CONTAIN \"' + DSA_CAMPAIGN_STRING + '\"')
    .withCondition('CampaignName DOES_NOT_CONTAIN \"' + SHO_CAMPAIGN_STRING + '\"');

  // Ignore label filter if needed
  if(typeof IGNORE_WEEK_LABELS !== "undefined" && IGNORE_WEEK_LABELS === 0) adGroupIterator =  adGroupIterator.withCondition('LabelNames CONTAINS_NONE ["' + AG_CHECK_LABEL + '"]');
  adGroupIterator = adGroupIterator.forDateRange(DATE_RANGE).forDateRange(DATE_RANGE).orderBy("Clicks DESC").get();

  while (adGroupIterator.hasNext()) {
    var adGroup = adGroupIterator.next();
    var adGroupName = adGroup.getName();
    var campaign = adGroup.getCampaign();
    var campaignName = adGroup.getCampaign().getName();

    // Skip Misspelling and typo adGroups
    var executeContinue = false;
    for(var i=0; i < ADGROUP_MISSPELLING_EXCLUDE_STRING.length; i++){
      if(adGroupName.indexOf(ADGROUP_MISSPELLING_EXCLUDE_STRING[i]) != -1) executeContinue = true;
    }
    if(executeContinue === true) {Logger.log("\nFound typo AG: " + adGroupName + " . Skipping adGroup break out..."); continue;}

    // Get near-exact related queries per adGroup
    ALLQUERIES = [];
    var relatedQueries = getRelatedQueries(adGroupName, campaignName);


    for(var i=0; i<relatedQueries.length; i++) {
      relatedQueries[i] = addQueryTypeInfo(relatedQueries[i]);

      var refCpc, keywordAvgCpc, keywordClicks, adGroupAvgCpc = adGroup.getStatsFor(DATE_RANGE).getAverageCpc(), adGroupClicks = adGroup.getStatsFor(DATE_RANGE).getClicks();

      try{
        refCpc = getRefKeywordMaxCpc(adGroup, relatedQueries[i].keyword) * NEAR_EXACT_BID_MODIFIER;
      } catch (e) {refCpc = relatedQueries[i].cpc * 1.05;}

      try{
        keywordAvgCpc = adGroup.keywords().withCondition('Text = "' + relatedQueries[i].keyword + '"').get().next().getStatsFor(DATE_RANGE).getAverageCpc();
        keywordClicks = adGroup.keywords().withCondition('Text = "' + relatedQueries[i].keyword + '"').get().next().getStatsFor(DATE_RANGE).getClicks();
      } catch (e) {keywordAvgCpc = adGroupAvgCpc;}
      if(LOG_LEVEL_VERBOSE === 1) Logger.log("adGroupClicks : " + adGroupClicks + " | keywordClicks : " + keywordClicks + " | queryClicks : " + relatedQueries[i].clicks + " ||| keywordAvgCpc : " + keywordAvgCpc + " | query.cpc : " + relatedQueries[i].cpc + "\n\n");

      var queryExistsAsKeyword = checkIfQueryExistsAsKeyword(campaign, adGroup, relatedQueries[i].queryString);

      /* Case 1: Create a new SKAG adgroup.
      *
      * The following requirements must be met:
      * 1. The query's clicks must exceed the click threshold
      * 2. The keyword distance to the query must be greater than the threshold
      * 3. The query's cpc must be 1.1 higher than the keywords
      * 4. The query's share of keyword clicks must be greater 1%
      * 5. The query must not be a spacing, word order or letter variant
      * 6. It must not already exist as a keyword
      */
      var queryObj = relatedQueries[i], skagCreated = false;

      if(queryObj.clicks >= SKAG_CLICK_THRESHOLD &&
        queryObj.kwDistance.simValue < CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minSimilarity_ToKeyword && queryObj.kwDistance.letterDist > 2 &&
        queryObj.cpc > (keywordAvgCpc * CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minRelativeCpc_ToKeyword) &&
        (queryObj.clicks / keywordClicks) > CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minShareOfKeywordClicks &&
        queryObj.queryType == "variant_word" &&
        queryExistsAsKeyword === false) {

        try{
          var skagAgName = adGroupName + " | " + relatedQueries[i].queryType.replace("variant", "Variant") + " (SKAG) | " + relatedQueries[i].queryString;
          Logger.log("\ncreating new skag adgroup : " + skagAgName);
          CREATED_ADGROUPS.push([campaignName, skagAgName, '[' + queryObj.queryString + ']', queryObj.clicks]);

          var skagAdgroup = getAdGroup(skagAgName, relatedQueries[i], adGroup);
          Logger.log("adding near exact query: " + "[" + relatedQueries[i].queryString + "] | type '"  + queryObj.queryType + "', kw '" +  queryObj.keyword + "'\n");
          setKeyword(skagAdgroup, refCpc, '[' + relatedQueries[i].queryString + ']', KEYWORD_LABEL_SPLIT + "__" + queryObj.queryTypes);
          skagCreated = true;

          if(SET_NEGATIVE_IN_QUERY_SOURCE === 1) setQueryNegativeInSource(adGroup, '[' + relatedQueries[i].queryString + ']' , queryObj.clicks);
        } catch(e) { if(LOG_LEVEL_VERBOSE === 1) Logger.log(e + ". stack : " + e.stack); }

      }


      /* CASE 2: Add to FALLBACK TYPOS ADGROUP
      *
      * The following requirements must be met:
      * 1. The setting to add a typo adgroup must be activated.
      * 2. The query must be a typo
      * 3. The query's clicks must exceed the click threshold
      */

      if(ADD_TYPO_QUERIES_TO_SEPARATE_ADGROUP === 1 &&
        (queryObj.clicks / keywordClicks) > CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minShareOfKeywordClicks &&
        relatedQueries[i].queryType === "typo") {
        Logger.log("\ncreating typo fallback adgroup : " + adGroupName + TYPO_ADGROUP_SUFFIX);

        var fallbackAdGroup_typos = getAdGroup(adGroupName + TYPO_ADGROUP_SUFFIX, relatedQueries[i], adGroup);
        var kwSet = setKeyword(fallbackAdGroup_typos, refCpc, '[' + queryObj.queryString + ']', KEYWORD_LABEL_SPLIT + "__" + queryObj.queryType);

        if(kwSet === true) {
          Logger.log("adding near exact query: " + "[" + queryObj.queryString + "] | type '"  + queryObj.queryType + "', kw '" +  queryObj.keyword + "'\n");
          CREATED_ADGROUPS.push([campaignName, adGroupName + TYPO_ADGROUP_SUFFIX, '[' + queryObj.queryString + ']', queryObj.clicks]);
        }

        if(SET_NEGATIVE_IN_QUERY_SOURCE === 1) setQueryNegativeInSource(adGroup, '[' + relatedQueries[i].queryString + ']' , queryObj.clicks);
      } // End if CASE 2


      /* CASE 3: ADD_CLOSE_VARIANTS_TO_SAME_ADGROUP
      *
      * The following requirements must be met:
      * 1. Close variants to adgroup must be allowed
      * 2. The query's clicks must exceed the click threshold
      * 3. The keyword distance to the query must be low
      * 4. The query's share of keyword clicks must be greater 1%
      * 5. The query must not be a typo
      * 6. It was not created as a SKAG in case 1.
      */

      if(ADD_CLOSE_VARIANTS_TO_SAME_ADGROUP === 1 && queryObj.kwDistance.simValue > CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minSimilarity_ToKeyword &&
         (queryObj.clicks / keywordClicks) > CLOSE_VARIANT_METRICS_TO_SAME_ADGROUP.minShareOfKeywordClicks && queryObj.queryType !== "typo" && skagCreated === false && queryObj.queryType !== "unknown" &&
         queryExistsAsKeyword === false) {

        Logger.log("\nadding keyword to same adgroup: " + adGroupName);
        var kwSet = setKeyword(adGroup, refCpc, '[' + queryObj.queryString + ']', KEYWORD_LABEL_SAME + "__" + queryObj.queryType);

        if(kwSet === true) {
          ADDED_KEYWORDS.push([campaignName, adGroupName, queryObj.queryString, queryObj.keyword, queryObj.queryType, queryObj.clicks]);
          Logger.log("adding near exact query: " + "[" + relatedQueries[i].queryString + "] | type '"  + queryObj.queryType + "', kw '" +  queryObj.keyword + "'\n");
        }
      } // End if CASE 3

    } // END For Queries loop
    provideLabel(AG_CHECK_LABEL);
    setCheckLabelToAdGroup(adGroup);

    ALLQUERIES = [];
    // Limit number of adgroup iterations by execution time
    var minutesRemaining = AdWordsApp.getExecutionInfo().getRemainingTime()/60;
    if (minutesRemaining < 5) {
      Logger.log("Execution time past twentyfive minutes. Stopping execution...");
      break;
    }

  } // END While adgroup

  sendNotificationEmail();
  removeOldAndUsedWeekLabels();
}


///////////////////////////

// Case 2: Add to fallback typos > NOT IMPLEMENTED, see below
/*


///////////////////////////



///////////////////////////
//// 1. QUERIES ///////////
///////////////////////////


/**
* @param {object} adGroup, the native Ads entity
* @param {object} campaign, the native Ads entity
* @return {array} queries, all queries triggered by the adGroup
**/
function getRelatedQueries(adGroup, campaign) {
  var queries = [], sqReport;

  try {
    var selectQuery =
        'SELECT Query,KeywordTextMatchingQuery,QueryMatchTypeWithVariant,CampaignName,AdGroupName,Clicks,Cost,Ctr,AverageCpc, Conversions,CostPerConversion,ConversionValue ' +
        'FROM SEARCH_QUERY_PERFORMANCE_REPORT ' +
        'WHERE KeywordTextMatchingQuery DOES_NOT_CONTAIN "+" AND QueryMatchTypeWithVariant = NEAR_EXACT AND Clicks >= ' + MIN_QUERY_CLICKS + ' AND AdGroupName = \"' + adGroup + '\" AND CampaignName = \"' + campaign + '\" ' +
        'DURING ' + DATE_RANGE;

    sqReport = AdWordsApp.report(selectQuery);
  } catch (e) { throw new Error("SearchQuerySelectException: " + e + ". Stacktrace: " + e.stack); }

  var sqReportRows = sqReport.rows();
  try { sqReportRows.next(); } catch (e) { return queries;}

  try {
    while (sqReportRows.hasNext()) {
      var row = sqReportRows.next();
      var queryString = row["Query"];
      var keyword = row["KeywordTextMatchingQuery"].toLowerCase();
      ALLQUERIES.push(row["Query"]);
      if (row["Query"] === keyword) continue;

      var query = {
        "queryString": queryString,
        "keyword": keyword,
        "matchtype": row["QueryMatchTypeWithVariant"],
        "clicks" : row["Clicks"],
        "cpc" : row["AverageCpc"],
        "conversions" : row["Conversions"],
        "campaign": row["CampaignName"],
        "adgroup": row["AdGroupName"]
      };
      queries.push(query);
    }
  } catch (e) { Logger.log("KeywordLookupException: " + e);}

  if (queries.length > 0) Logger.log("\n*****\nFound " + queries.length + " Queries in AdGroup : " + adGroup + " ( " + campaign + " )\n\n");

  return queries;
}


/*
* @param {object} adGroup
* @param {string} queryString
* @return {bool} queryExistsAsKeyword
*/
function checkIfQueryExistsAsKeyword(campaign, adGroup, queryString) {
  var queryExistsAsKeyword = false;

  var keywordSelector = adGroup.keywords().withCondition('Text = "' + queryString + '"').get();
  if(keywordSelector.totalNumEntities() > 0) queryExistsAsKeyword = true;

  return queryExistsAsKeyword;
}


/**
* @param {object} queryObject, containing all query info
* @return {object} queryObject, an enhanced object with the attribute "queryType"
**/
function addQueryTypeInfo(queryObject){

  try{
    var keyword = queryObject.queryString.replace(/ /g,"+").replace(/-/g,"+").replace(/_/g,"+");
    var querySorted_nonSpace = queryObject.queryString.split(" ").sort().join(" ").replace(/ /g, "");
    var keywordSorted_nonSpace = queryObject.keyword.split(" ").sort().join(" ").replace(/ /g, "");

    var levenshteinDist2Kw_sorted = dziemba_levenshtein(querySorted_nonSpace, keywordSorted_nonSpace);

    if(Math.abs(querySorted_nonSpace.length - keywordSorted_nonSpace.length) !== levenshteinDist2Kw_sorted) {
      levenshteinDist2Kw_sorted = Math.abs(querySorted_nonSpace.length - keywordSorted_nonSpace.length);
    }

    var simMetric2Kw_sorted = (1-levenshteinDist2Kw_sorted/queryObject.keyword.length).toFixed(2);
    queryObject.kwDistance = {"simValue" : simMetric2Kw_sorted, "letterDist" : levenshteinDist2Kw_sorted};

    // Early return skipping Google Suggest call
    if(queryObject.keyword.split(" ").sort().join(" ") === queryObject.queryString.split(" ").sort().join(" ")) {
      queryObject.queryType = "variant_wordorder";
    }

    if(replaceSpecialCharacters(queryObject.keyword) === replaceSpecialCharacters(queryObject.queryString)) {
      queryObject.queryType = "variant_letter";
    }

    if(queryObject.keyword.replace(/ /g, "") === queryObject.queryString.replace(/ /g, "")) {
      queryObject.queryType = "variant_spacing";
    }

    // Validate typos via custom search engine
    if(typeof queryObject.queryType == "undefined") {

      if(typeof getTypoCorrection(queryObject.queryString) !== "undefined") {

        var correctedTypo = getTypoCorrection(queryObject.queryString);
        var levenshteinDist2Typo = dziemba_levenshtein(queryObject.queryString.replace(/ /g, ""), correctedTypo.replace(/ /g, ""));
        var simMetric2Typo = (1-levenshteinDist2Typo/correctedTypo.length).toFixed(2);

        if(simMetric2Typo != 1) {
          queryObject.suggestKeyword = {"term" : correctedTypo, "simValue" : simMetric2Typo};
          queryObject.queryType = "typo";
        }
        if(simMetric2Typo == 1) {
          queryObject.suggestKeyword = {"term" : correctedTypo, "simValue" : simMetric2Typo};
          queryObject.queryType = "variant_spacing";
        }

      }
    }

    // Find word variants via Google Suggest
    var firstEntry;
    if(typeof queryObject.queryType == "undefined"){
      firstEntry = getFirstEntryOfSuggestCall(keyword);

      if(typeof firstEntry !== "undefined") {
        var levenshteinDist = dziemba_levenshtein(queryObject.queryString, firstEntry);
        var simMetric = (1-levenshteinDist/firstEntry.length).toFixed(2);

        queryObject.suggestKeyword = {"term" : firstEntry, "simValue" : simMetric};

        if(simMetric == 1) queryObject.queryType = "variant_word";
        if(simMetric != 1 && firstEntry.indexOf(queryObject.queryString) != -1) queryObject.queryType = "variant_word";
      }
    }

    // Remove spacing to check for spacing variants
    if(typeof queryObject.queryType == "undefined" && typeof firstEntry !== "undefined") {
      if(firstEntry.replace(/ /g, "").replace(/\-/g, "") === queryObject.queryString.replace(/ /g, "").replace(/\-/g, "")) queryObject.queryType = "";
    }

    // If no related Google suggest entryCheck for suggestions for sorted queryString
    if(typeof queryObject.queryType == "undefined"){
      var sortedKeyword = queryObject.queryString.replace(/-/g," ").replace(/_/g," ").split(" ").sort().join(" ").replace(/ /g,"+").replace(/-/g,"+").replace(/_/g,"+");
      var firstEntry_sorted = getFirstEntryOfSuggestCall(sortedKeyword);

      if(firstEntry_sorted === queryObject.queryString.split(" ").sort().join(" "))  queryObject.queryType = "variant_word";
    }

    if(typeof queryObject.queryType == "undefined") queryObject.queryType = "unknown";

  } catch(e){
    if(LOG_LEVEL_VERBOSE === 1) Logger.log(e + ". stack : " + e.stack);
    return queryObject;
  }

  if(LOG_LEVEL_VERBOSE === 1) Logger.log("queryObject : " + JSON.stringify(queryObject));
  return queryObject;
}


/**
* @param {string} keyword, a keyword with pluses instead of spaces
* @return {string} firstEntry, the first return value from the Google suggest response
**/
function getFirstEntryOfSuggestCall(keyword) {
  var firstEntry;
  var xmlRequestUrl = "https://suggestqueries.google.com/complete/search?output=toolbar&hl="+ GOOGLE_CUSTOM_SEARCH_CONFIG.lang +"&q=" + keyword;
  var xmlDocument = XmlService.parse(UrlFetchApp.fetch(xmlRequestUrl).getContentText());

  try {
    firstEntry = xmlDocument.getRootElement().getChildren('CompleteSuggestion')[0].getChild('suggestion').getAttribute('data').getValue();
  } catch(e) {if(LOG_LEVEL_VERBOSE === 1) Logger.log("No Google suggest entry found for : " + keyword);}

  return firstEntry;
}



/**
* @param {string} query
* @return {string} correctedQuery
**/
function getTypoCorrection(query) {

  var correctedQuery, response, url;

  // Retrieve the CSE id from your project console: https://cse.google.com/cse/all
  var cx = "014836489453389152633:ccrrjjwbm3f";

  // Create an API after here after selecting your project: https://developers.google.com/custom-search/v1/introduction
  var api_key = 'AIzaSyDAhGbL17bkG2WtCvTXMMpzkMR0ZyS3xew';
  var api_endPoint_free = 'https://www.googleapis.com/customsearch/v1';

  try{
    url = api_endPoint_free + '?cx=' + cx + '&key=' + api_key + '&googlehost=' + GOOGLE_CUSTOM_SEARCH_CONFIG.googlehost + '&gl=' + GOOGLE_CUSTOM_SEARCH_CONFIG.lang + '&q=' + query + '&alt=json&num=1';
    response = JSON.parse(UrlFetchApp.fetch(url).getContentText());
  }
  catch(e) {
    try{
      // Fallback to restricted & paid CSE
      if(LOG_LEVEL_VERBOSE === 1) Logger.log("Free daily API Limit reached. Moving to restricted search API...");
      var api_endPoint_paid = 'https://www.googleapis.com/customsearch/v1/siterestrict';
      url = api_endPoint_paid + '?cx=' + cx + '&key=' + api_key + '&googlehost=' + GOOGLE_CUSTOM_SEARCH_CONFIG.googlehost + '&gl=' + GOOGLE_CUSTOM_SEARCH_CONFIG.lang + '&q=' + query + '&alt=json&num=1';
      response = JSON.parse(UrlFetchApp.fetch(url).getContentText());
    } catch(e2) {
        Logger.log(e2 + " . stack : " + e2.stack);
        return correctedQuery;
    }
  }

  if(typeof response.spelling !== "undefined") correctedQuery = response.spelling.correctedQuery.replace(',',' ').replace('.',' ');

  return correctedQuery;
}



///////////////////////////
//// 2. CLONE /////////////
///////////////////////////


/**
* @param {object} adGroupName
* @param {object} queryObject, containing all info relevant to the query context
* @param {object} refAdGroup, the native Ads entity
* @return {object} adGroup, the native Ads entity
**/
function getAdGroup(adGroupName, queryObject, refAdGroup) {

  var adGroup, campaign = refAdGroup.getCampaign();

  try{
    adGroup = campaign.adGroups().withCondition('Name CONTAINS_IGNORE_CASE \"' + adGroupName + '\"').get().next();
  } catch(e){
    var adGroupBuilder = campaign.newAdGroupBuilder();
    var adGroupOperation = adGroupBuilder.withName(adGroupName).withStatus("ENABLED").build();
    var adGroup = adGroupOperation.getResult();

    cloneNonKeywordEntities(adGroup, refAdGroup, queryObject);
    provideLabel(AG_CHECK_LABEL);
    adGroup.applyLabel(AG_CHECK_LABEL);
  }
  return adGroup;
}


/**
* @param {object} adGroup, the native Ads entity
* @param {object} refAdGroup, the native Ads entity
* @param {object} queryObject, containing all info relevant to the query context
* @return {void}
**/
function cloneNonKeywordEntities(adGroup, refAdGroup, queryObject){
  var campaign = refAdGroup.getCampaign();

  try{
    cloneActiveAds(adGroup, refAdGroup, queryObject);
    // cloneDeviceModifier(adGroup, refAdGroup, queryObject);
    cloneSitelinks(adGroup, refAdGroup);
    setNegatives(adGroup, refAdGroup, queryObject);
  } catch (e){ if(LOG_LEVEL_VERBOSE === 1) Logger.log(e + ". stack : " + e.stack); }
}


/** NOT IMPLEMENTED !!!
* @param {object} adGroup, the native Ads entity
* @param {object} refAdGroup, the native Ads entity
* @param {object} queryObject, containing all info relevant to the query context
* @return {void}
**/
function cloneDeviceModifier(adGroup, refAdGroup, queryObject){
  // NOT IMPLEMENTED !!!
  var awql_deviceValues = ["DESKTOP", "HIGH_END_MOBILE", "TABLET"];

  try{
    var selectQuery =
        'SELECT Keyword,Cpc FROM KEYWORDS_PERFORMANCE_REPORT ' +
        'WHERE KeywordTextMatchingQuery STARTS_WITH_IGNORE_CASE "' + queryObject.keyword + '" AND Device = ' + device + ' AND QueryMatchTypeWithVariant = EXACT AND Clicks > 2 AND AdGroupName = \"' + refAdGroup.getName() + '\" AND CampaignName = \"' + refAdGroup.getCampaign().getName() + '\" ' +
        'DURING LAST_30_DAYS ';
    sqReport = AdWordsApp.report(selectQuery);
  } catch (e) { throw new Error("SearchQuerySelectException: " + e + ". Stacktrace: " + e.stack); }

  var sqReportRows = sqReport.rows();
  try { sqReportRows.next(); } catch (e) {
    if(LOG_LEVEL_VERBOSE === 1) {
      Logger.log(e + ". stack : " + e.stack);
      return queries;
    }
  }

  // NOT IMPLEMENTED !!!
  try {
    while (sqReportRows.hasNext()) {
      var row = sqReportRows.next();
      var Cpc = row["Cpc"].toLowerCase();

      var mobileModifer = refAdGroup.targeting().platforms().mobile().get().next(); // >> setting not available
      var tabletModifer, desktopModifer;
    }
  } catch(e){ if(LOG_LEVEL_VERBOSE === 1) Logger.log(e + ". stack : " + e.stack);}
  // NOT IMPLEMENTED !!!
}


/**
* @param {object} refAdGroup, the native Ads entity
* @param {object} adGroup, the native Ads entity
* @param {object} queryObject, containing all info relevant to the query context
* @return {void}
**/
function cloneActiveAds(adGroup, refAdGroup, queryObject) {

  var refAdIterator = refAdGroup.ads().withCondition('Type = EXPANDED_TEXT_AD').withCondition("Status = ENABLED").get();
  var adCount = 0;
  var adIterator = adGroup.ads().withCondition('Type = EXPANDED_TEXT_AD').withCondition("Status = ENABLED").get();
  if(adIterator.totalNumEntities() > 0) return;

  while (refAdIterator.hasNext()) {
    if(adCount > 3) break;
    var refAd = refAdIterator.next();
    var ad_h1 = refAd.getHeadlinePart1(), ad_h2 = refAd.getHeadlinePart2(), ad_h3 = refAd.getHeadlinePart3();
    var ad_desc1 = refAd.getDescription1(), ad_desc2 = refAd.getDescription2(), ad_path1 = refAd.getPath1(), ad_path2 = refAd.getPath2();
    var ad_url = refAd.urls().getFinalUrl();

    // Skip ad if incorrect params
    var fullAdString = ad_h1 + "|" + ad_h2 + "|" + ad_h3 + "|" + ad_desc1 + "|" + ad_desc2;
    if(fullAdString.indexOf("{PH") != -1) break;

    // Replace ad values with query if SKAG and non-typo
    if(queryObject.queryType.indexOf("SKAG") != -1 && queryObject.queryType.indexOf("variant") != -1) {
      var regexString = new RegExp(queryObject.keyword.replace(/\+/g,""));
      var upperCasedQuery = upperCaseFirstLetter(queryObject.queryString);

      if(ad_h1.indexOf(queryObject.keyword) !== -1) ad_h1 = ad_h1.replace(regexString, upperCasedQuery);
      if(ad_h1.indexOf(queryObject.keyword) == -1) ad_h1 = upperCasedQuery;

      ad_h2 = ad_h2.replace(regexString, upperCasedQuery);
      ad_desc1 = ad_desc1.replace(regexString, upperCasedQuery);
      ad_path1 = ad_path1.replace(regexString, upperCasedQuery);

      if(ad_h3) ad_h3 = ad_h3.replace(regexString, upperCasedQuery);
      if(ad_desc2) ad_desc2 = ad_desc2.replace(regexString, upperCasedQuery);
      if(ad_path2) ad_path2 = ad_path2.replace(regexString, upperCasedQuery);
    } // END IF-SKAG

    var adPreBuild = adGroup.newAd().expandedTextAdBuilder()
      .withHeadlinePart1(ad_h1).withHeadlinePart2(ad_h2)
      .withDescription1(ad_desc1)
      .withPath1(ad_path1).withFinalUrl(ad_url);

    if(ad_h3) adPreBuild = adPreBuild.withHeadlinePart3(ad_h3);
    if(ad_desc2) adPreBuild = adPreBuild.withDescription2(ad_desc2);
    if(ad_path2) adPreBuild = adPreBuild.withPath2(ad_path2);

    var adOperation = adPreBuild.build();
    adCount++;
  }
}


/**
* @param {object} refAdGroup, the native Ads entity
* @param {object} adGroup, the native Ads entity
* @return {void}
**/
function cloneSitelinks(adGroup, refAdGroup) {

  var refSitelinkIterator = refAdGroup.extensions().sitelinks().withCondition('Impressions > 0').forDateRange('LAST_30_DAYS').get();

  var sitelinkIterator = adGroup.extensions().sitelinks().get();

  if(sitelinkIterator.totalNumEntities() < 4) {
    if(LOG_LEVEL_VERBOSE === 1) Logger.log("Adgroup sitelinks will NOT (!) be cloned due to insufficient amount, ie less than 4. ");
    return;
  }

  while (refSitelinkIterator.hasNext()) {
    var refSitelink = refSitelinkIterator.next();
    var currentDate = parseInt(new Date().toISOString().substring(0, 10).replace(/-/g,""));
    var endDateYmd = convertDateObjToYmd(currentDate, refSitelink.getEndDate()) ;
    var sitelinkBuilder = AdsApp.extensions().newSitelinkBuilder();

    if(endDateYmd > (currentDate+7))var sitelinkOperation = adGroup.addSitelink(refSitelink);
  }
}


/**
* @param {object} adGroup, the native Ads entity
* @param {float} maxCpc
* @param {string} keyword, a string containing matchtype syntax
* @return {bool} wasSuccessful
**/
function setKeyword(adGroup, cpc, keyword, label) {
  var wasSuccessful = false;
  try {
    if(adGroup.keywords().withCondition('Text = "' + keyword + '"').get().totalNumEntities() === 0) {
      var keyWordOperation = adGroup.newKeywordBuilder().withText(keyword).withCpc(cpc).build();
      provideLabel(label);

      if(keyWordOperation.isSuccessful() === true) wasSuccessful = true;
      keyWordOperation.getResult().applyLabel(label);
    }
  } catch(e) { Logger.log(e + " . stack : " + e.stack); }

  return wasSuccessful;
}


/**
* @param {object} refAdGroup, the native Ads entity
* @param {string} keyword, a string containing matchtype syntax
* @return {float} maxCpc
**/
function getRefKeywordMaxCpc(refAdGroup, keyword) {

  var maxCpc = 0;
  try{
    maxCpc = refAdGroup.keywords().withCondition('KeywordMatchType = EXACT').withCondition('Text STARTS_WITH_IGNORE_CASE "' + keyword + '"').get().next().bidding().getCpc();
  } catch(e) {if(LOG_LEVEL_VERBOSE === 1) Logger.log(e + ". stack : " + e.stack); maxCpc = 0.5;}

  return maxCpc;
}


/**
* @param {object} adGroup, the native Ads entity
* @param {object} refAdGroup, the native Ads entity
* @param {object} queryObject, containing all info relevant to the query context
* @return {void}
**/
function setNegatives(adGroup, refAdGroup, queryObject) {

  var negativesListWithoutOwn = ALLQUERIES;
  negativesListWithoutOwn.splice(negativesListWithoutOwn.indexOf(queryObject.queryString),1);
  negativesListWithoutOwn = negativesListWithoutOwn.push(queryObject.keyword);

  for(var i=0; i< negativesListWithoutOwn.length; i++) {
    if(queryObject.queryString !== negativesListWithoutOwn[i]) adGroup.createNegativeKeyword('[' + negativesListWithoutOwn[i] + ']');
  }
  /*var refNegativeIterator = refAdGroup.negativeKeywords().get();

  while (refNegativeIterator.hasNext()) {
    var negativeKeyword = refNegativeIterator.next().getText();
    adGroup.createNegativeKeyword(negativeKeyword);
  }*/
}



/**
* @param {object} refAdGroup, the native Ads entity
* @param {string} keyword, a string containing matchtype syntax
* @return {void}
**/
function setQueryNegativeInSource(refAdGroup, keyword) {
  if(refAdGroup.negativeKeywords().withCondition('Text = "' + keyword + '"').get().totalNumEntities() === 0) {
    refAdGroup.createNegativeKeyword(keyword);
  }
}

function removeOldAndUsedWeekLabels() {
  var currentCheckLabel = AG_CHECK_LABEL;
  var checkLabelStem = AG_CHECK_LABEL.split("_")[0];

  // Removing old labels and removing their associations
  var labelIterator = AdsApp.labels()
    .withCondition('Name CONTAINS_IGNORE_CASE "' + checkLabelStem + '"')
    .withCondition('Name != "' + currentCheckLabel + '"')
    .get();

  while(labelIterator.hasNext()) {
    var label = labelIterator.next();
    var adGroupIterator = label.adGroups().get();

    while(adGroupIterator.hasNext()){
      var adGroup = adGroupIterator.next();
      adGroup.removeLabel(label.getName());
    }

    if(label.adGroups().get().totalNumEntities() === 0) label.remove();
  }
}

function setCheckLabelToAdGroup(adGroup) {
  var currentCheckLabel = AG_CHECK_LABEL;
  var checkLabelStem = AG_CHECK_LABEL.split("_")[0];

  // Removing old labels first
  var labelIterator = adGroup.labels()
    .withCondition('Name CONTAINS_IGNORE_CASE "' + checkLabelStem + '"')
    .withCondition('Name != "' + currentCheckLabel + '"')
    .get();

  while(labelIterator.hasNext()) {
    var label = labelIterator.next().getName();
    adGroup.removeLabel(label);
  }

  // Adding new week label
  var currentLabelIterator = adGroup.labels().withCondition('Name = "' + currentCheckLabel + '"').get();
  if(currentLabelIterator.totalNumEntities === 0) adGroup.applyLabel(currentCheckLabel);

}


///////////////////////////
//// 3. UTILITIES /////////
///////////////////////////


function getWeekLabel() {
  return "nrNearExactSplit-Check_Week_" + parseInt(new Date().getWeek(),10) + "_Yr_" + parseInt(new Date().getWeekYear(),10).toString();
}

// HELPER FUNCTION FOR LABEL
// Source: https://weeknumber.net/how-to/javascript
// Returns the ISO week of the date.
Date.prototype.getWeek = function() {
  var date = new Date(this.getTime());
  date.setHours(0, 0, 0, 0);
  // Thursday in current week decides the year.
  date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
  // January 4 is always in week 1.
  var week1 = new Date(date.getFullYear(), 0, 4);
  // Adjust to Thursday in week 1 and count number of weeks from date to week1.
  return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
};

// Returns the four-digit year corresponding to the ISO week of the date.
Date.prototype.getWeekYear = function() {
  var date = new Date(this.getTime());
  date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
  return date.getFullYear();
};


/**
* @param {string} a, the first string
* @param {string} b, the second string to be compared to the first one
* @return {int} res, an integer for the number of letter changes
**/
function dziemba_levenshtein(a, b){
  var tmp;
  if (a.length === 0) { return b.length; }
  if (b.length === 0) { return a.length; }
  if (a.length > b.length) { tmp = a; a = b; b = tmp; }

  var i, j, res, alen = a.length, blen = b.length, row = Array(alen);
  for (i = 0; i <= alen; i++) { row[i] = i; }

  for (i = 1; i <= blen; i++) {
    res = i;
    for (j = 1; j <= alen; j++) {
      tmp = row[j - 1];
      row[j - 1] = res;
      res = b[i - 1] === a[j - 1] ? tmp : Math.min(tmp + 1, Math.min(res + 1, row[j] + 1));
    }
  }
  return res;
}


/**
* @param {string} ngram, a string with one or multiple words
* @return {void}
**/
function upperCaseFirstLetter(ngram){
  var ngramArray = ngram.split(" ");
  var ngramUpperCased;

  for(var i=0; i < ngramArray.length; i++) {
    var updatedString = ngramArray[i].toString().charAt(0).toUpperCase() + ngramArray[i].slice(1) + " ";
    ngramUpperCased += updatedString;
  }
  return ngramUpperCased.trim();
}


/**
* @param {string} string
* @return {void}
**/
function replaceSpecialCharacters(string){
  return string.replace(//g,"a").replace(//g,"ss").replace(//g,"u").replace(//g,"o").replace(/ae/g,"a").replace(/ue/g,"u").replace(//g,"oe");
}


/**
* @param {string} currentDate, string in the form YYYYMMDD
* @param {object} dateObj, the native Ads date object
* @return {string} dateYmd, a date string in the form YYYYMMDD
**/
function convertDateObjToYmd(currentDate, dateObj){
  var endDate = dateObj !== null ? dateObj.year + "-" + dateObj.month + "-" + dateObj.day : null;
  var dateYmd = dateObj !== null ?  parseInt(endDate.replace(/-/g,"")) : currentDate + 10;

  return dateYmd;
}


/**
* @param {string} labelName
* @return {void}
**/
function provideLabel(labelName){
  try {
    var labelSelector = AdsApp.labels().withCondition("Name = '" + labelName + "'").get();
    if (labelSelector.totalNumEntities() === 0) AdsApp.createLabel(labelName);
  } catch (e) { if(LOG_LEVEL_VERBOSE === 1) Logger.log("LabelOperationException: " + e + "\n");}
}


/**
* @return {void}
**/
function sendNotificationEmail() {
  var subject = AdWordsApp.currentAccount().getName() + ' | NearExactHandler Summary for (' + DATE_RANGE + ') ';
  var body = subject, htmlOutput;

  var htmlBody = '<html><body>Dear PPC Pro,<br><br>Here are the near-exact handling results (new keywords and agroups) of your last run for date range ' + DATE_RANGE  + ' and <b>min ' + MIN_QUERY_CLICKS + '</b> clicks per query<br><br>';

  htmlBody += "<br><br>****************<br><br><b>1. Newly created AdGroups</b><br><br>";

  if(CREATED_ADGROUPS.length > 1){
    htmlBody += '<table border="1" width="70%" style="border-collapse:collapse;">';
    htmlBody += '<tr><td align="center"><b>Campaign</b></td>';
    htmlBody += '<td align="center"><b>AdGroup</b></td>';
    htmlBody += '<td align="center"><b>Single_Keyword</b></td>';
    htmlBody += '<td align="center"><b>Previous Clicks</b></td></tr>';

    for(i=1; i<CREATED_ADGROUPS.length; i++) {
      htmlBody += "<tr>";
      for(var j=0; j<CREATED_ADGROUPS[i].length; j++) {
         if(j === 3) {
          htmlBody += '<td align="center">' + CREATED_ADGROUPS[i][j]+'</td>';
        } else htmlBody += "<td>" + CREATED_ADGROUPS[i][j] + "</td>";
      }
      htmlBody += "</tr>";
    }
    htmlBody += '<br/><br/></table><br><br>';
  }


  htmlBody += "<br><br>****************<br><br><b>2. New keywords added to existing AdGroup</b><br>";

  if(ADDED_KEYWORDS.length > 1){
    htmlBody += '<table border="1" width="100%" style="border-collapse:collapse;">';
    htmlBody += '<tr><td align="center"><b>Campaign</b></td>';
    htmlBody += '<td align="center"><b>AdGroup</b></td>';
    htmlBody += '<td align="center"><b>New Keyword</b></td>';
    htmlBody += '<td align="center"><b>Source Keyword</b></td>';
    htmlBody += '<td align="center"><b>Query Type</b></td>';
    htmlBody += '<td align="center"><b>Previous Clicks</b></td></tr>';

    for(i=1; i<ADDED_KEYWORDS.length; i++) {
      htmlBody += "<tr>";
      for(var j=0; j<ADDED_KEYWORDS[i].length; j++) {
         if(j === 5) {
          htmlBody += '<td align="center">' + ADDED_KEYWORDS[i][j]+'</td>';
        } else htmlBody += "<td>" + ADDED_KEYWORDS[i][j] + "</td>";
      }
      htmlBody += "</tr>";
    }
    htmlBody += '<br/><br/></table><br><br>';
  }


  var options = { htmlBody : htmlBody };

  if(CREATED_ADGROUPS.length > 1 || ADDED_KEYWORDS.length > 1) {
    for(var i = 0; i<EMAIL_RECIPIENTS.length; i++) {
      MailApp.sendEmail(EMAIL_RECIPIENTS[i], subject, body, options);
      Logger.log("Email sent.");
    }
  }
}
